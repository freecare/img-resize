!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ImgResize=e()}(this,function(){"use strict";function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],a=!0,n=!1,i=void 0;try{for(var o,c=t[Symbol.iterator]();!(a=(o=c.next()).done)&&(r.push(o.value),!e||r.length!==e);a=!0);}catch(t){n=!0,i=t}finally{try{a||null==c.return||c.return()}finally{if(n)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t){var e,r,a,n,i,o=Math.floor,c=new Array(64),s=new Array(64),u=new Array(64),f=new Array(64),h=new Array(65535),v=new Array(65535),l=new Array(64),d=new Array(64),g=[],y=0,m=7,w=new Array(64),p=new Array(64),A=new Array(64),b=new Array(256),I=new Array(2048),k=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],M=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],j=[0,1,2,3,4,5,6,7,8,9,10,11],P=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],C=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],x=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],S=[0,1,2,3,4,5,6,7,8,9,10,11],B=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],O=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function E(t,e){for(var r=0,a=0,n=new Array,i=1;i<=16;i++){for(var o=1;o<=t[i];o++)n[e[a]]=[],n[e[a]][0]=r,n[e[a]][1]=i,a++,r++;r*=2}return n}function T(t){for(var e=t[0],r=t[1]-1;r>=0;)e&1<<r&&(y|=1<<m),r--,--m<0&&(255==y?(z(255),z(0)):z(y),m=7,y=0)}function z(t){g.push(b[t])}function U(t){z(t>>8&255),z(255&t)}function Q(t,e,r,a,n){for(var i,o=n[0],c=n[240],s=function(t,e){var r,a,n,i,o,c,s,u,f,h,v=0;for(f=0;f<8;++f){r=t[v],a=t[v+1],n=t[v+2],i=t[v+3],o=t[v+4],c=t[v+5],s=t[v+6];var d=r+(u=t[v+7]),g=r-u,y=a+s,m=a-s,w=n+c,p=n-c,A=i+o,b=i-o,I=d+A,k=d-A,M=y+w,j=y-w;t[v]=I+M,t[v+4]=I-M;var P=.707106781*(j+k);t[v+2]=k+P,t[v+6]=k-P;var C=.382683433*((I=b+p)-(j=m+g)),x=.5411961*I+C,S=1.306562965*j+C,B=.707106781*(M=p+m),O=g+B,E=g-B;t[v+5]=E+x,t[v+3]=E-x,t[v+1]=O+S,t[v+7]=O-S,v+=8}for(v=0,f=0;f<8;++f){r=t[v],a=t[v+8],n=t[v+16],i=t[v+24],o=t[v+32],c=t[v+40],s=t[v+48];var T=r+(u=t[v+56]),z=r-u,U=a+s,Q=a-s,R=n+c,q=n-c,D=i+o,F=i-o,L=T+D,H=T-D,_=U+R,W=U-R;t[v]=L+_,t[v+32]=L-_;var X=.707106781*(W+H);t[v+16]=H+X,t[v+48]=H-X;var N=.382683433*((L=F+q)-(W=Q+z)),G=.5411961*L+N,J=1.306562965*W+N,K=.707106781*(_=q+Q),V=z+K,Y=z-K;t[v+40]=Y+G,t[v+24]=Y-G,t[v+8]=V+J,t[v+56]=V-J,v++}for(f=0;f<64;++f)h=t[f]*e[f],l[f]=h>0?h+.5|0:h-.5|0;return l}(t,e),u=0;u<64;++u)d[k[u]]=s[u];var f=d[0]-r;r=d[0],0==f?T(a[0]):(T(a[v[i=32767+f]]),T(h[i]));for(var g=63;g>0&&0==d[g];g--);if(0==g)return T(o),r;for(var y,m=1;m<=g;){for(var w=m;0==d[m]&&m<=g;++m);var p=m-w;if(p>=16){y=p>>4;for(var A=1;A<=y;++A)T(c);p&=15}i=32767+d[m],T(n[(p<<4)+v[i]]),T(h[i]),m++}return 63!=g&&T(o),r}function R(t){if(t<=0&&(t=1),t>100&&(t=100),i!=t){(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var a=o((e[r]*t+50)/100);a<1?a=1:a>255&&(a=255),c[k[r]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],i=0;i<64;i++){var h=o((n[i]*t+50)/100);h<1?h=1:h>255&&(h=255),s[k[i]]=h}for(var v=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],l=0,d=0;d<8;d++)for(var g=0;g<8;g++)u[l]=1/(c[k[l]]*v[d]*v[g]*8),f[l]=1/(s[k[l]]*v[d]*v[g]*8),l++})(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),i=t}}this.encode=function(t,i,o){i&&R(i),g=new Array,y=0,m=7,U(65496),U(65504),U(16),z(74),z(70),z(73),z(70),z(0),z(1),z(1),z(0),U(1),U(1),z(0),z(0),function(){U(65499),U(132),z(0);for(var t=0;t<64;t++)z(c[t]);z(1);for(var e=0;e<64;e++)z(s[e])}(),function(t,e){U(65472),U(17),z(8),U(e),U(t),z(3),z(1),z(17),z(0),z(2),z(17),z(1),z(3),z(17),z(1)}(t.width,t.height),function(){U(65476),U(418),z(0);for(var t=0;t<16;t++)z(M[t+1]);for(var e=0;e<=11;e++)z(j[e]);z(16);for(var r=0;r<16;r++)z(P[r+1]);for(var a=0;a<=161;a++)z(C[a]);z(1);for(var n=0;n<16;n++)z(x[n+1]);for(var i=0;i<=11;i++)z(S[i]);z(17);for(var o=0;o<16;o++)z(B[o+1]);for(var c=0;c<=161;c++)z(O[c])}(),U(65498),U(12),z(3),z(1),z(0),z(2),z(17),z(3),z(17),z(0),z(63),z(0);var h=0,v=0,l=0;y=0,m=7,this.encode.displayName="_encode_";for(var d,b,k,E,q,D,F,L,H,_=t.data,W=t.width,X=t.height,N=4*W,G=0;G<X;){for(d=0;d<N;){for(D=q=N*G+d,F=-1,L=0,H=0;H<64;H++)D=q+(L=H>>3)*N+(F=4*(7&H)),G+L>=X&&(D-=N*(G+1+L-X)),d+F>=N&&(D-=d+F-N+4),b=_[D++],k=_[D++],E=_[D++],w[H]=(I[b]+I[k+256>>0]+I[E+512>>0]>>16)-128,p[H]=(I[b+768>>0]+I[k+1024>>0]+I[E+1280>>0]>>16)-128,A[H]=(I[b+1280>>0]+I[k+1536>>0]+I[E+1792>>0]>>16)-128;h=Q(w,u,h,e,a),v=Q(p,f,v,r,n),l=Q(A,f,l,r,n),d+=32}G+=8}if(m>=0){var J=[];J[1]=m+1,J[0]=(1<<m+1)-1,T(J)}if(U(65497),o){for(var K=g.length,V=new Uint8Array(K),Y=0;Y<K;Y++)V[Y]=g[Y].charCodeAt();return g=[],V}var Z="data:image/jpeg;base64,"+btoa(g.join(""));return g=[],Z},t||(t=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)b[e]=t(e)}(),e=E(M,j),r=E(x,S),a=E(P,C),n=E(B,O),function(){for(var t=1,e=2,r=1;r<=15;r++){for(var a=t;a<e;a++)v[32767+a]=r,h[32767+a]=[],h[32767+a][1]=r,h[32767+a][0]=a;for(var n=-(e-1);n<=-t;n++)v[32767+n]=r,h[32767+n]=[],h[32767+n][1]=r,h[32767+n][0]=e-1+n;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)I[t]=19595*t,I[t+256>>0]=38470*t,I[t+512>>0]=7471*t+32768,I[t+768>>0]=-11059*t,I[t+1024>>0]=-21709*t,I[t+1280>>0]=32768*t+8421375,I[t+1536>>0]=-27439*t,I[t+1792>>0]=-5329*t}(),R(t)}var a=function(){var t=navigator.userAgent,e=/OS (\d+)_.* like Mac OS X/g.exec(t),r=/Android[\s\/](\d.*?)[\s;]/g.exec(t);return{oldIOS:!!e&&+e.pop()<8,oldAndroid:!!r&&+r.pop().substring(0,3)<4.5,ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(t),android:/Android/g.test(t),mQQBrowser:/MQQBrowser/g.test(t)}};function n(t,e,r,a,n){switch(n){case 5:case 6:case 7:case 8:t.width=a,t.height=r;break;default:t.width=r,t.height=a}switch(n){case 2:e.translate(r,0),e.scale(-1,1);break;case 3:e.translate(r,a),e.rotate(Math.PI);break;case 4:e.translate(0,a),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-a);break;case 7:e.rotate(.5*Math.PI),e.translate(r,-a),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-r,0)}}function i(t,e,r,a){var i=t.naturalWidth,o=t.naturalHeight,c=r.width,s=r.height,u=e.getContext("2d");u.save(),n(e,u,c,s,r.orientation),function(t){var e=t.naturalWidth;if(e*t.naturalHeight>1048576){var r=document.createElement("canvas");r.width=r.height=1;var a=r.getContext("2d");return a.drawImage(t,1-e,0),0===a.getImageData(0,0,1,1).data[3]}return!1}(t)&&(i/=2,o/=2);var f=1024,h=document.createElement("canvas");h.width=h.height=f;for(var v=h.getContext("2d"),l=a?function(t,e,r){var a=document.createElement("canvas");a.width=1,a.height=r;var n=a.getContext("2d");n.drawImage(t,0,0);for(var i=n.getImageData(0,0,1,r).data,o=0,c=r,s=r;s>o;){0===i[4*(s-1)+3]?c=s:o=s,s=c+o>>1}var u=s/r;return 0===u?1:u}(t,0,o):1,d=Math.ceil(f*c/i),g=Math.ceil(f*s/o/l),y=0,m=0;y<o;){for(var w=0,p=0;w<i;)v.clearRect(0,0,f,f),v.drawImage(t,-w,-y),u.drawImage(h,0,0,f,f,p,m,d,g),w+=f,p+=d;y+=f,m+=g}u.restore(),h=v=null}function o(t,e){for(var r=t.split(","),a=r[0].match(/:(.*?);/)[1],n=atob(r[1]),i=n.length,o=new Uint8Array(i);i--;)o[i]=n.charCodeAt(i);return new File([o],e,{type:a})}function c(t,e,r){return r?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}return function(){function s(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),this.file=t,this.options=Object.assign({quality:.8,orientation:1,type:"image/jpeg"},e);var r=a();this.isIOS=r.ios,this.needEncoder=r.oldAndroid||r.mQQBrowser||!navigator.userAgent,this.canvas=document.createElement("canvas"),this.img=null}var u,f,h;return u=s,(f=[{key:"resize",value:function(){var t=this;return this.getImage().then(function(r){t.img=r;var a=t.options,n=a.width,o=a.height,c=a.quality,s=a.orientation,u=e(t.getSize(n,o,t.img.width,t.img.height),2),f=u[0],h=u[1];return t.options.width=f,t.options.height=h,t.isIOS?i(t.img,t.canvas,{width:f,height:h,quality:c,orientation:s},!0):function(t,e,r,a){var n=e.getContext("2d");e.width=r,e.height=a,n.save(),n.drawImage(t,0,0,r,a),n.restore()}(t.img,t.canvas,f,h),t.file,t.canvas})}},{key:"init",value:function(){return this.img?Promise.resolve():this.resize()}},{key:"resizeToBase64",value:function(){try{var t=this;return c(t.init(),function(){return t.createBase64()})}catch(t){return Promise.reject(t)}}},{key:"resizeToFile",value:function(){try{var t=this;return c(t.resizeToBase64(),function(e){return o(e,t.file.name)})}catch(t){return Promise.reject(t)}}},{key:"rotateToBase64",value:function(t){try{var e=this;return c(e.init(),function(){return c(e.rotate(t),function(){return e.createBase64()})})}catch(t){return Promise.reject(t)}}},{key:"rotateToFile",value:function(t){try{var e=this;return c(e.rotateToBase64(t),function(t){return o(t,e.file.name)})}catch(t){return Promise.reject(t)}}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.options.orientation;if(t!==e){"number"==typeof t?e=t:e+=t?1:-1,e=e%8||8,this.options.orientation=e;var r=this.canvas.getContext("2d");n(this.canvas,r,this.options.width,this.options.height,this.options.orientation);var a=this.canvas,i=a.width,o=a.height;if(e>4){var c=[o,i];i=c[0],o=c[1]}r.drawImage(this.img,0,0,i,o)}}},{key:"getImage",value:function(){var t=this;return new Promise(function(e,r){var a=Object.prototype.toString.call(t.file);if("[object File]"===a){t.options.type=t.file.type;var n=new Image;n.onload=function(){return e(n)},n.onerror=function(t){return r(t)},n.src=URL.createObjectURL(t.file)}else"[object HTMLImageElement]"===a?e(t.file):r()})}},{key:"createBase64",value:function(){var t=this.options,e=t.width,a=t.height,n=t.quality;if(this.needEncoder){var i=new r(100*n),o=this.canvas.getContext("2d");return i.encode(o.getImageData(0,0,e,a))}return this.canvas.toDataURL(this.options.type,n)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3264,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2448,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(t=Math.min(t,3264),e=Math.min(e,2448),r<=t&&a<=e)return[r,a];var n=a?r/a:1;return r>t&&(r=t,a=Math.ceil(r/n)),a>e&&(a=e,r=Math.ceil(a*n)),[r,a]}}])&&t(u.prototype,f),h&&t(u,h),s}()});
//# sourceMappingURL=img-resize.min.js.map
